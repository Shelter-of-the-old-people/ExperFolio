# Experfolio 회원가입 및 로그인 Use Case

## 1. 회원가입 Use Case

### 1.1 기본 회원가입 플로우
**Actor**: 신규 사용자
**Goal**: 새로운 계정 생성

**Pre-condition**: 
- 사용자가 유효한 이메일 주소를 가지고 있음
- 이메일이 시스템에 중복 등록되지 않음

**Main Flow**:
1. 사용자가 회원가입 페이지에 접근
2. 사용자 기본 정보 입력
   - 이메일 (필수, 고유값)
   - 비밀번호 (필수, 8자 이상)
   - 이름 (필수)
   - 전화번호 (선택)
3. 사용자 역할 선택
   - JOB_SEEKER (구직자/학생)
   - RECRUITER (채용담당자)
4. 시스템이 입력 데이터 유효성 검증
5. 비밀번호 BCrypt 암호화 후 저장
6. 사용자 상태를 PENDING으로 설정
7. 이메일 인증 토큰 생성 및 발송
8. 회원가입 완료 메시지 표시

**Post-condition**:
- 사용자 계정이 PENDING 상태로 생성됨
- 이메일 인증 대기 상태

**Exception Flow**:
- E1: 이메일 중복 → "이미 등록된 이메일입니다" 메시지
- E2: 비밀번호 규칙 위반 → "비밀번호는 8자 이상이어야 합니다" 메시지
- E3: 필수 입력값 누락 → 해당 필드 오류 메시지
- E4: 이메일 발송 실패 → "이메일 발송에 실패했습니다" 메시지

### 1.2 이메일 인증 플로우
**Actor**: 가입한 사용자
**Goal**: 이메일 주소 인증 완료

**Main Flow**:
1. 사용자가 이메일에서 인증 링크 클릭
2. 시스템이 토큰 유효성 검증
3. 사용자 상태를 ACTIVE로 변경
4. 인증 완료 메시지 표시
5. 로그인 페이지로 리다이렉트

**Exception Flow**:
- E1: 토큰 만료 → "인증 링크가 만료되었습니다" + 재발송 옵션
- E2: 잘못된 토큰 → "유효하지 않은 인증 링크입니다"

### 1.3 역할별 프로필 생성
**Actor**: 인증된 사용자
**Goal**: 역할에 맞는 상세 프로필 작성

**구직자(JOB_SEEKER) 프로필**:
- 개인정보: 생년월일, 성별, 주소
- 학력정보: 학교명, 전공, 졸업상태
- 경력정보: 인턴/프로젝트 경험
- 기술스택: 사용 가능 기술
- 희망조건: 직무, 근무지역, 연봉
- 포트폴리오 URL 목록

**채용담당자(RECRUITER) 프로필**:
- 회사정보: 회사명, 업종, 규모
- 담당자 정보: 부서, 직급
- 회사 인증: 사업자등록번호, 인증문서
- 인증 상태: PENDING → APPROVED

## 2. 로그인 Use Case

### 2.1 기본 로그인 플로우
**Actor**: 등록된 사용자
**Goal**: 시스템에 안전하게 로그인

**Pre-condition**:
- 사용자가 ACTIVE 상태의 계정을 가지고 있음
- 올바른 이메일과 비밀번호를 알고 있음

**Main Flow**:
1. 사용자가 로그인 페이지에 접근
2. 이메일과 비밀번호 입력
3. 시스템이 사용자 정보 조회 및 검증
   - 이메일 존재 여부 확인
   - 비밀번호 일치 여부 확인 (BCrypt)
   - 사용자 상태 확인 (ACTIVE만 허용)
4. JWT 토큰 생성
   - Access Token (30분 유효)
   - Refresh Token (7일 유효)
5. 토큰 정보 응답
   - 토큰값, 만료시간, 사용자 정보, 역할
6. 역할별 메인 페이지로 리다이렉트
   - JOB_SEEKER → 구직자 대시보드
   - RECRUITER → 채용담당자 검색 페이지

**Post-condition**:
- 사용자가 인증된 상태로 시스템에 접근 가능
- JWT 토큰이 발급되어 API 호출 가능

**Exception Flow**:
- E1: 존재하지 않는 이메일 → "등록되지 않은 이메일입니다"
- E2: 비밀번호 불일치 → "비밀번호가 일치하지 않습니다"
- E3: 비활성 계정 → "계정이 비활성 상태입니다. 관리자에게 문의하세요"
- E4: 정지된 계정 → "계정이 정지되었습니다. 관리자에게 문의하세요"
- E5: 인증 대기 계정 → "이메일 인증을 완료해주세요"

### 2.2 토큰 갱신 플로우
**Actor**: 로그인된 사용자
**Goal**: Access Token 갱신

**Main Flow**:
1. Access Token 만료 시 클라이언트가 자동으로 갱신 요청
2. Refresh Token 유효성 검증
3. 새로운 Access Token 발급 (30분 유효)
4. 기존 Refresh Token 연장 (7일 유효)

**Exception Flow**:
- E1: Refresh Token 만료 → 재로그인 필요
- E2: 잘못된 Refresh Token → 재로그인 필요

### 2.3 로그아웃 플로우
**Actor**: 로그인된 사용자
**Goal**: 안전하게 로그아웃

**Main Flow**:
1. 사용자가 로그아웃 버튼 클릭
2. 클라이언트에서 토큰 정보 삭제
3. 로그인 페이지로 리다이렉트
4. 로그아웃 완료 메시지 표시

## 3. 비밀번호 관리 Use Case

### 3.1 비밀번호 재설정
**Actor**: 등록된 사용자
**Goal**: 잊어버린 비밀번호 재설정

**Main Flow**:
1. 사용자가 "비밀번호 찾기" 클릭
2. 등록된 이메일 입력
3. 시스템이 이메일 존재 여부 확인
4. 비밀번호 재설정 토큰 생성 및 이메일 발송
5. 사용자가 이메일에서 재설정 링크 클릭
6. 새 비밀번호 입력 및 확인
7. 비밀번호 BCrypt 암호화 후 업데이트
8. 재설정 완료 메시지 표시

### 3.2 비밀번호 변경
**Actor**: 로그인된 사용자
**Goal**: 현재 비밀번호를 새 비밀번호로 변경

**Main Flow**:
1. 사용자가 계정 설정에서 "비밀번호 변경" 선택
2. 현재 비밀번호, 새 비밀번호, 비밀번호 확인 입력
3. 현재 비밀번호 검증
4. 새 비밀번호 규칙 검증
5. 비밀번호 업데이트
6. 변경 완료 메시지 표시

## 4. 계정 상태 관리

### 4.1 계정 상태별 접근 권한
- **ACTIVE**: 모든 기능 사용 가능
- **INACTIVE**: 로그인 불가, 재활성화 필요
- **PENDING**: 이메일 인증 대기, 로그인 불가
- **SUSPENDED**: 관리자에 의한 정지, 로그인 불가

### 4.2 계정 탈퇴 (소프트 삭제)
**Main Flow**:
1. 사용자가 계정 탈퇴 요청
2. 비밀번호 재확인
3. 탈퇴 사유 입력 (선택)
4. 계정 상태를 INACTIVE로 변경
5. 개인정보는 보존, 로그인만 차단
6. 탈퇴 완료 메시지 표시

## 5. 보안 고려사항

### 5.1 인증 보안
- JWT 토큰 기반 stateless 인증
- Access Token 짧은 만료시간 (30분)
- Refresh Token 적절한 만료시간 (7일)
- BCrypt를 통한 비밀번호 암호화

### 5.2 API 보안
- 역할 기반 접근 제어 (RBAC)
- CORS 설정으로 허용된 도메인만 접근
- 401/403 에러 처리
- XSS, CSRF 방어 헤더 설정

### 5.3 데이터 보호
- 개인정보 암호화 저장
- 소프트 삭제로 데이터 보존
- 이메일 인증을 통한 계정 확인
- 비밀번호 재설정 토큰 만료 관리


---

## 6. Use Case 시각화 (ASCII Diagrams)

### 6.1 회원가입 플로우차트

```
                    ┌─────────────────────┐
                    │     회원가입          │
                    │    페이지 접근         │
                    └──────────┬──────────┘
                               │
                               ▼
                    ┌─────────────────────┐
                    │   사용자 정보 입력      │
                    │ ┌─────────────────┐ │
                    │ │ • 이메일          │ │
                    │ │ • 비밀번호        │ │
                    │ │ • 이름           │ │
                    │ │ • 전화번호        │ │
                    │ │ • 역할 선택       │ │
                    │ └─────────────────┘ │
                    └──────────┬──────────┘
                               │
                               ▼
                    ┌─────────────────────┐
                    │   입력 데이터          │
                    │     유효성 검증        │
                    └──────────┬──────────┘
                               │
                 ┌─────────────┴─────────────┐
                 │                           │
                 ▼                           ▼
       ┌─────────────────┐           ┌─────────────────┐
       │   유효성 오류      │           │   검증 통과       │
       │                 │           │                 │
       │ • 이메일 중복      │           │ • BCrypt 암호화   │
       │ • 비밀번호 규칙    │            │ • PENDING 상태   │
       │ • 필수값 누락      │           │ • 이메일 토큰      │
       └─────────────────┘           └─────────┬───────┘
                                               │
                                               ▼
                                    ┌─────────────────┐
                                    │   인증 이메일      │
                                    │      발송        │
                                    └─────────┬───────┘
                                              │
                                              ▼
                                    ┌─────────────────┐
                                    │  회원가입 완료     │
                                    │ (PENDING 상태)   │
                                    └─────────────────┘
```

### 6.2 로그인 플로우차트

```
                    ┌─────────────────────┐
                    │    로그인 요청         │
                    │ ┌─────────────────┐ │
                    │ │ • 이메일          │ │
                    │ │ • 비밀번호        │ │
                    │ └─────────────────┘ │
                    └──────────┬──────────┘
                              │
                              ▼
                    ┌─────────────────────┐
                    │   사용자 인증 검증      │
                    │                     │
                    │ 1. 이메일 존재 확인     │
                    │ 2. 비밀번호 BCrypt    │
                    │ 3. 계정 상태 확인      │
                    └──────────┬──────────┘
                               │
                 ┌─────────────┴─────────────┐
                 │                           │
                 ▼                           ▼
    ┌─────────────────────┐       ┌─────────────────────┐
    │     인증 실패         │       │     인증 성공         │
    │                     │       │                     │
    │ • 잘못된 이메일        │       │ • JWT 토큰 생성       │
    │ • 비밀번호 불일치       │       │ • Access (30분)     │
    │ • 비활성 계정          │       │ • Refresh (7일)     │
    │ • 정지된 계정          │       │                     │
    └─────────────────────┘       └──────────┬──────────┘
                                             │
                                             ▼
                                  ┌─────────────────────┐
                                  │    역할별 리다이렉트     │
                                  │                     │
                                  │ JOB_SEEKER   ────►  │
                                  │   구직자 대시보드       │
                                  │                     │
                                  │ RECRUITER    ────►  │
                                  │   채용 검색페이지       │
                                  └─────────────────────┘
```

### 6.3 사용자 상태 전이도

```
    ┌─────────────────────────────────────────────────────────┐
    │                 사용자 상태 전이 다이어그램                    │
    └─────────────────────────────────────────────────────────┘

                           회원가입
                              │
                              ▼
                    ┌─────────────────┐
                    │    PENDING      │◄──── 이메일 재발송
                    │   (인증 대기)     │
                    └─────────┬───────┘
                             │
                       이메일 인증
                             │
                             ▼
                    ┌─────────────────┐
                    │     ACTIVE      │
                    │   (정상 활동)     │◄──── 계정 복구
                    └─────┬───────────┘
                         │
            ┌────────────┼────────────┐
            │            │            │
           사용자        관리자         사용자
           비활성화       정지          탈퇴
            │            │            │
            ▼            ▼            ▼
    ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
    │  INACTIVE   │ │ SUSPENDED   │ │  INACTIVE   │
    │  (비활성)     │ │   (정지)     │ │  (탈퇴)      │
    └─────────────┘ └─────────────┘ └─────────────┘
           ▲               ▲
           │               │
         재활성화         정지해제
```

### 6.4 인증 시스템 아키텍처

```
    ┌─────────────────────────────────────────────────────────┐
    │                JWT 토큰 기반 인증 시스템                     │
    └─────────────────────────────────────────────────────────┘

    Client                  Server                 Database
      │                       │                       │
      │ 1. 로그인 요청           │                       │
      │ ──────────────────►   │                       │
      │   (이메일/비밀번호)       │ 2. 사용자 조회           │
      │                       │ ──────────────────►   │
      │                       │                       │
      │                       │ ◄──────────────────   │
      │                       │   사용자 정보            │
      │                       │                       │
      │ ◄──────────────────   │                       │
      │   JWT 토큰 응답         │ 3. 토큰 생성             │
      │   ┌─────────────────┐ │                       │
      │   │ Access Token    │ │                       │
      │   │ Refresh Token   │ │                       │
      │   │ User Info       │ │                       │
      │   └─────────────────┘ │                       │
      │                       │                       │
      │ 4. API 요청            │                       │
      │ ──────────────────►   │                       │
      │   (Authorization)     │ 5. 토큰 검증            │
      │                       │                       │
      │ ◄──────────────────   │                       │
      │   API 응답             │                       │
      │                       │                       │
      │                       │                       │
      │ 6. 토큰 갱신 요청         │                       │
      │ ──────────────────►   │                       │
      │   (Refresh Token)     │                       │
      │                       │                       │
      │ ◄──────────────────   │                       │
      │   새 Access Token     │                       │

```

### 6.5 역할별 기능 분리도

```
    ┌─────────────────────────────────────────────────────────┐
    │                   역할 기반 접근 제어                        │
    └─────────────────────────────────────────────────────────┘

                           ┌─────────────┐
                           │    User     │
                           │  (공통)      │
                           └──────┬──────┘
                                 │
                    ┌────────────┴────────────┐
                    │                         │
                    ▼                         ▼
          ┌─────────────────┐       ┌─────────────────┐
          │   JOB_SEEKER    │       │    RECRUITER    │
          │     (구직자)      │       │   (채용담당자)     │
          └─────────────────┘       └─────────────────┘
                    │                         │
    ┌───────────────┼───────────────┐         │
    │               │               │         │
    ▼               ▼               ▼         ▼
┌──────────┐ ┌──────────────┐ ┌─────────┐ ┌─────────────┐
│개인정보    │ │포트폴리오       │ │프로필     │ │AI 검색       │
│관리       │ │업로드/관리      │ │조회      │ │시스템         │
└──────────┘ └──────────────┘ └─────────┘ └─────────────┘
     │              │              │            │
     │              │              │            │
┌──────────┐ ┌──────────────┐ ┌─────────┐ ┌─────────────┐
│경력/학력   │ │기술스택        │ │희망조건    │ │후보자        │
│입력       │ │관리           │ │설정       │ │필터링        │
└──────────┘ └──────────────┘ └─────────┘ └─────────────┘
                                                │
                                         ┌─────────────┐
                                         │연락처         │
                                         │관리          │
                                         └─────────────┘

    ┌─────────────────────────────────────────────────────────┐
    │                    접근 제한 매트릭스                       │
    ├─────────────────┬─────────────┬─────────────────────────┤
    │     기능         │ JOB_SEEKER  │      RECRUITER          │
    ├─────────────────┼─────────────┼─────────────────────────┤
    │ 프로필 작성        │     ✓       │          ✗              │
    │ 포트폴리오 관리     │     ✓       │          ✗              │
    │ AI 검색          │     ✗       │          ✓              │
    │ 후보자 필터링      │     ✗       │          ✓              │
    │ 후보자 연락        │     ✗       │          ✓              │
    │ 회사 인증         │     ✗       │          ✓              │
    └─────────────────┴─────────────┴─────────────────────────┘
```

### 6.6 데이터 플로우 다이어그램

```
    ┌─────────────────────────────────────────────────────────┐
    │              구직자 → 채용담당자 검색 플로우                   │
    └─────────────────────────────────────────────────────────┘

    구직자 입력                 시스템 처리                채용담당자 검색
        │                          │                          │
        ▼                          ▼                          ▼
    ┌─────────┐     입력      ┌─────────────┐    검색     ┌─────────────┐
    │개인정보   │ ─────────►   │  데이터 전처리 │  ◄──────── │자연어 검색     │
    │학력정보   │              │  및 벡터화    │            │프롬프트       │
    │경력정보   │              └──────┬──────┘            └─────────────┘
    │기술스택   │                     │                          │
    └─────────┘                     ▼                          │
        │                   ┌─────────────┐                    │
        │                   │  Vector DB  │                    │
        │                   │   저장소     │                     │
        │                   └──────┬──────┘                    │
        │                          │                           │
        ▼                          ▼                           ▼
    ┌─────────┐             ┌─────────────┐            ┌─────────────┐
    │포트폴리오  │             │ RAG 시스템   │            │ 검색 결과      │
    │URL 관리   │            │ 유사도 매칭    │   ─────►   │ • 매칭 점수   │
    └─────────┘             └─────────────┘            │ • 후보자 목록  │
                                                       │ • 필터링      │
                                                       └─────────────┘
```